# OKE (Oracle Kubernetes Engine) cluster configuration

# Gateway configuration (Phase 1: disabled, Phase 2: enabled)
gateway:
  enabled: true
# Common configurations
common-resources: &common-resources
  limits:
    cpu: 50m
    memory: 256Mi
  requests:
    cpu: 10m
    memory: 128Mi
ae-analyzer:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/beaverhouse/tinyclover-ae-analyzer
    pullPolicy: IfNotPresent
    tag: "8ce28414"
  imagePullSecrets:
    - name: ghcr-secret
  nameOverride: "ae-analyzer"
  fullnameOverride: "ae-analyzer"
  service:
    type: ClusterIP
    api:
      port: 8086
    mcp:
      enabled: false
  resources: *common-resources
  livenessProbe:
    httpGet:
      path: /ae-analyzer/v1/health
      port: api
    periodSeconds: 120
  readinessProbe:
    httpGet:
      path: /ae-analyzer/v1/health
      port: api
    periodSeconds: 120
  externalSecret:
    enabled: true
    data:
      - secretKey: "POSTGRES_HOST"
        remoteRef:
          key: "SUPABASE_POSTGRES_HOST"
      - secretKey: "POSTGRES_USER"
        remoteRef:
          key: "SUPABASE_POSTGRES_USER"
      - secretKey: "POSTGRES_PASSWORD"
        remoteRef:
          key: "SUPABASE_POSTGRES_PASSWORD"
      - secretKey: "SUPABASE_JWT_KEYFUNC_URL"
        remoteRef:
          key: "SUPABASE_JWT_KEYFUNC_URL"
  httproute:
    enabled: true
    parentRefs:
      - name: api-gateway
        sectionName: https-api
    hostnames:
      - api.tinyclover.com
    annotations:
      external-dns.alpha.kubernetes.io/hostname: api.tinyclover.com
      external-dns.alpha.kubernetes.io/set-identifier: "oke-cluster-gateway"
      external-dns.alpha.kubernetes.io/aws-weight: "100"
    rules:
      - path:
          type: PathPrefix
          value: /ae-analyzer/v1
        timeouts:
          request: 60s
          backendRequest: 60s
  clientSettings:
    enabled: true
    body:
      maxSize: 10m
      timeout: 60s
  envFrom:
    - secretRef:
        name: ae-analyzer-secret
  extraEnv:
    - name: GO_ENV
      value: "production"
ba-analyzer:
  enabled: true
  replicaCount: 2
  image:
    repository: ghcr.io/beaverhouse/tinyclover-ba-analyzer
    pullPolicy: IfNotPresent
    tag: "18208a4e"
  imagePullSecrets:
    - name: ghcr-secret
  nameOverride: "ba-analyzer"
  fullnameOverride: "ba-analyzer"
  service:
    type: ClusterIP
    api:
      port: 8085
    mcp:
      enabled: true
      port: 8105
  resources: *common-resources
  livenessProbe:
    httpGet:
      path: /ba-analyzer/v1/health
      port: api
    periodSeconds: 120
  readinessProbe:
    httpGet:
      path: /ba-analyzer/v1/health
      port: api
    periodSeconds: 120
  externalSecret:
    enabled: true
    data:
      - secretKey: "POSTGRES_HOST"
        remoteRef:
          key: "SUPABASE_POSTGRES_HOST"
      - secretKey: "POSTGRES_USER"
        remoteRef:
          key: "SUPABASE_POSTGRES_USER"
      - secretKey: "POSTGRES_PASSWORD"
        remoteRef:
          key: "SUPABASE_POSTGRES_PASSWORD"
      - secretKey: "SUPABASE_JWT_KEYFUNC_URL"
        remoteRef:
          key: "SUPABASE_JWT_KEYFUNC_URL"
      - secretKey: "SUPABASE_PUBLIC_S3_CDN_URL"
        remoteRef:
          key: "SUPABASE_PUBLIC_S3_CDN_URL"
      - secretKey: "GEMINI_API_KEY"
        remoteRef:
          key: "GEMINI_API_KEY"
      - secretKey: "YOUTUBE_API_KEY"
        remoteRef:
          key: "YOUTUBE_API_KEY"
  httproute:
    enabled: true
    parentRefs:
      - name: api-gateway
        sectionName: https-api
    hostnames:
      - api.tinyclover.com
    annotations:
      external-dns.alpha.kubernetes.io/hostname: api.tinyclover.com
      external-dns.alpha.kubernetes.io/set-identifier: "oke-cluster-gateway"
      external-dns.alpha.kubernetes.io/aws-weight: "100"
    rules:
      - path:
          type: PathPrefix
          value: /ba-analyzer/v1
        timeouts:
          request: 60s
          backendRequest: 60s
  clientSettings:
    enabled: true
    body:
      maxSize: 10m
      timeout: 60s
  envFrom:
    - secretRef:
        name: ba-analyzer-secret
  extraEnv:
    - name: GO_ENV
      value: "production"
file-manager:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/beaverhouse/tinyclover-file-manager
    pullPolicy: IfNotPresent
    tag: "b5f62dd8"
  imagePullSecrets:
    - name: ghcr-secret
  nameOverride: "file-manager"
  fullnameOverride: "file-manager"
  service:
    type: ClusterIP
    api:
      port: 8081
    mcp:
      enabled: false
  resources: *common-resources
  livenessProbe:
    httpGet:
      path: /file-manager/v1/health
      port: api
    periodSeconds: 120
  readinessProbe:
    httpGet:
      path: /file-manager/v1/health
      port: api
    periodSeconds: 120
  externalSecret:
    enabled: true
    data:
      - secretKey: "POSTGRES_HOST"
        remoteRef:
          key: "SUPABASE_POSTGRES_HOST"
      - secretKey: "POSTGRES_USER"
        remoteRef:
          key: "SUPABASE_POSTGRES_USER"
      - secretKey: "POSTGRES_PASSWORD"
        remoteRef:
          key: "SUPABASE_POSTGRES_PASSWORD"
      - secretKey: "S3_ENDPOINT"
        remoteRef:
          key: "SUPABASE_PUBLIC_S3_ENDPOINT"
      - secretKey: "S3_ACCESS_KEY"
        remoteRef:
          key: "SUPABASE_PUBLIC_S3_ACCESS_KEY"
      - secretKey: "S3_SECRET_KEY"
        remoteRef:
          key: "SUPABASE_PUBLIC_S3_SECRET_KEY"
      - secretKey: "S3_BUCKET_NAME"
        remoteRef:
          key: "SUPABASE_PUBLIC_S3_BUCKET_NAME"
  httproute:
    enabled: true
    parentRefs:
      - name: api-gateway
        sectionName: https-api
    hostnames:
      - api.tinyclover.com
    annotations:
      external-dns.alpha.kubernetes.io/hostname: api.tinyclover.com
      external-dns.alpha.kubernetes.io/set-identifier: "oke-cluster-gateway"
      external-dns.alpha.kubernetes.io/aws-weight: "100"
    rules:
      - path:
          type: PathPrefix
          value: /file-manager/v1
        timeouts:
          request: 300s
          backendRequest: 300s
  clientSettings:
    enabled: true
    body:
      maxSize: 100m
      timeout: 300s
  envFrom:
    - secretRef:
        name: file-manager-secret
  extraEnv:
    - name: GO_ENV
      value: "production"
llm-client:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/beaverhouse/tinyclover-llm-client
    pullPolicy: IfNotPresent
    tag: "11755ed9"
  imagePullSecrets:
    - name: ghcr-secret
  nameOverride: "llm-client"
  fullnameOverride: "llm-client"
  service:
    type: ClusterIP
    api:
      port: 8080
    mcp:
      enabled: false
  resources: *common-resources
  livenessProbe:
    httpGet:
      path: /v1/health
      port: api
    periodSeconds: 120
  readinessProbe:
    httpGet:
      path: /v1/health
      port: api
    periodSeconds: 120
  externalSecret:
    enabled: true
    data:
      - secretKey: "POSTGRES_HOST"
        remoteRef:
          key: "SUPABASE_POSTGRES_HOST"
      - secretKey: "POSTGRES_USER"
        remoteRef:
          key: "SUPABASE_POSTGRES_USER"
      - secretKey: "POSTGRES_PASSWORD"
        remoteRef:
          key: "SUPABASE_POSTGRES_PASSWORD"
      - secretKey: "SUPABASE_JWT_KEYFUNC_URL"
        remoteRef:
          key: "SUPABASE_JWT_KEYFUNC_URL"
      - secretKey: "LITELLM_API_KEY"
        remoteRef:
          key: "LITELLM_API_KEY"
      - secretKey: "LITELLM_MASTER_KEY"
        remoteRef:
          key: "LITELLM_MASTER_KEY"
      - secretKey: "BA_ANALYZER_SERVICE_TOKEN"
        remoteRef:
          key: "BA_ANALYZER_SERVICE_TOKEN"
  httproute:
    enabled: true
    parentRefs:
      - name: api-gateway
        sectionName: https-llm
    hostnames:
      - llm.tinyclover.com
    annotations:
      external-dns.alpha.kubernetes.io/hostname: llm.tinyclover.com
      external-dns.alpha.kubernetes.io/set-identifier: "oke-cluster-gateway"
      external-dns.alpha.kubernetes.io/aws-weight: "100"
    rules:
      - path:
          type: PathPrefix
          value: /v1
        timeouts:
          request: 60s
          backendRequest: 60s
  clientSettings:
    enabled: true
    body:
      maxSize: 10m
      timeout: 60s
  envFrom:
    - secretRef:
        name: llm-client-secret
  extraEnv:
    - name: GO_ENV
      value: "production"
    - name: LITELLM_ENDPOINT
      value: "http://litellm.litellm.svc.cluster.local:4000"
data-aggregator:
  enabled: true
  replicaCount: 2
  image:
    repository: ghcr.io/beaverhouse/tinyclover-data-aggregator
    pullPolicy: IfNotPresent
    tag: "caebc4dc"
  imagePullSecrets:
    - name: ghcr-secret
  nameOverride: "data-aggregator"
  fullnameOverride: "data-aggregator"
  service:
    type: ClusterIP
    api:
      port: 8082
    mcp:
      enabled: true
      port: 8102
  resources: *common-resources
  livenessProbe:
    httpGet:
      path: /data-aggregator/v1/health
      port: api
    periodSeconds: 120
  readinessProbe:
    httpGet:
      path: /data-aggregator/v1/health
      port: api
    periodSeconds: 120
  externalSecret:
    enabled: true
    data:
      - secretKey: "POSTGRES_HOST"
        remoteRef:
          key: "SUPABASE_POSTGRES_HOST"
      - secretKey: "POSTGRES_USER"
        remoteRef:
          key: "SUPABASE_POSTGRES_USER"
      - secretKey: "POSTGRES_PASSWORD"
        remoteRef:
          key: "SUPABASE_POSTGRES_PASSWORD"
      - secretKey: "SUPABASE_JWT_KEYFUNC_URL"
        remoteRef:
          key: "SUPABASE_JWT_KEYFUNC_URL"
      - secretKey: "NAVER_CLIENT_ID"
        remoteRef:
          key: "NAVER_CLIENT_ID"
      - secretKey: "NAVER_CLIENT_SECRET"
        remoteRef:
          key: "NAVER_CLIENT_SECRET"
      - secretKey: "BRAVE_SEARCH_API_KEY"
        remoteRef:
          key: "BRAVE_SEARCH_API_KEY"
  httproute:
    enabled: true
    parentRefs:
      - name: api-gateway
        sectionName: https-api
    hostnames:
      - api.tinyclover.com
    annotations:
      external-dns.alpha.kubernetes.io/hostname: api.tinyclover.com
      external-dns.alpha.kubernetes.io/set-identifier: "oke-cluster-gateway"
      external-dns.alpha.kubernetes.io/aws-weight: "100"
    rules:
      - path:
          type: PathPrefix
          value: /data-aggregator/v1
        timeouts:
          request: 60s
          backendRequest: 60s
  clientSettings:
    enabled: true
    body:
      maxSize: 10m
      timeout: 60s
  envFrom:
    - secretRef:
        name: data-aggregator-secret
  extraEnv:
    - name: GO_ENV
      value: "production"
    - name: MCP_BASE_URL
      value: "http://data-aggregator.tiny-clover.svc.cluster.local:8102/data-aggregator/v1"
life-organizer:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/beaverhouse/tinyclover-life-organizer
    pullPolicy: IfNotPresent
    tag: "38e80894"
  imagePullSecrets:
    - name: ghcr-secret
  nameOverride: "life-organizer"
  fullnameOverride: "life-organizer"
  service:
    type: ClusterIP
    api:
      port: 8083
    mcp:
      enabled: true
      port: 8103
  resources: *common-resources
  livenessProbe:
    httpGet:
      path: /life-organizer/v1/health
      port: api
    periodSeconds: 120
  readinessProbe:
    httpGet:
      path: /life-organizer/v1/health
      port: api
    periodSeconds: 120
  externalSecret:
    enabled: true
    data:
      - secretKey: "POSTGRES_HOST"
        remoteRef:
          key: "SUPABASE_POSTGRES_HOST"
      - secretKey: "POSTGRES_USER"
        remoteRef:
          key: "SUPABASE_POSTGRES_USER"
      - secretKey: "POSTGRES_PASSWORD"
        remoteRef:
          key: "SUPABASE_POSTGRES_PASSWORD"
      - secretKey: "SUPABASE_JWT_KEYFUNC_URL"
        remoteRef:
          key: "SUPABASE_JWT_KEYFUNC_URL"
  httproute:
    enabled: true
    parentRefs:
      - name: api-gateway
        sectionName: https-api
    hostnames:
      - api.tinyclover.com
    annotations:
      external-dns.alpha.kubernetes.io/hostname: api.tinyclover.com
      external-dns.alpha.kubernetes.io/set-identifier: "oke-cluster-gateway"
      external-dns.alpha.kubernetes.io/aws-weight: "100"
    rules:
      - path:
          type: PathPrefix
          value: /life-organizer/v1
        timeouts:
          request: 60s
          backendRequest: 60s
  clientSettings:
    enabled: true
    body:
      maxSize: 10m
      timeout: 60s
  envFrom:
    - secretRef:
        name: life-organizer-secret
  extraEnv:
    - name: GO_ENV
      value: "production"
    - name: MCP_BASE_URL
      value: "http://life-organizer.tiny-clover.svc.cluster.local:8103/life-organizer/v1"
service-api:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/beaverhouse/tinyclover-service-api
    pullPolicy: IfNotPresent
    tag: "5402a34a"
  imagePullSecrets:
    - name: ghcr-secret
  nameOverride: "service-api"
  fullnameOverride: "service-api"
  service:
    type: ClusterIP
    api:
      port: 5050
    mcp:
      enabled: false
  resources: *common-resources
  livenessProbe:
    httpGet:
      path: /service-api/v1/health
      port: api
    periodSeconds: 120
  readinessProbe:
    httpGet:
      path: /service-api/v1/health
      port: api
    periodSeconds: 120
  externalSecret:
    enabled: true
    data:
      - secretKey: "POSTGRES_HOST"
        remoteRef:
          key: "SUPABASE_POSTGRES_HOST"
      - secretKey: "POSTGRES_USER"
        remoteRef:
          key: "SUPABASE_POSTGRES_USER"
      - secretKey: "POSTGRES_PASSWORD"
        remoteRef:
          key: "SUPABASE_POSTGRES_PASSWORD"
      - secretKey: "SUPABASE_JWT_KEYFUNC_URL"
        remoteRef:
          key: "SUPABASE_JWT_KEYFUNC_URL"
      - secretKey: "LEMON_SQUEEZY_WEBHOOK_SECRET"
        remoteRef:
          key: "LEMON_SQUEEZY_WEBHOOK_SECRET"
      - secretKey: "LITELLM_MASTER_KEY"
        remoteRef:
          key: "LITELLM_MASTER_KEY"
  httproute:
    enabled: true
    parentRefs:
      - name: api-gateway
        sectionName: https-api
    hostnames:
      - api.tinyclover.com
    annotations:
      external-dns.alpha.kubernetes.io/hostname: api.tinyclover.com
      external-dns.alpha.kubernetes.io/set-identifier: "oke-cluster-gateway"
      external-dns.alpha.kubernetes.io/aws-weight: "100"
    rules:
      - path:
          type: PathPrefix
          value: /service-api/v1
        timeouts:
          request: 60s
          backendRequest: 60s
  clientSettings:
    enabled: true
    body:
      maxSize: 10m
      timeout: 60s
  envFrom:
    - secretRef:
        name: service-api-secret
  extraEnv:
    - name: GO_ENV
      value: "production"
    - name: LITELLM_ENDPOINT
      value: "http://litellm.litellm.svc.cluster.local:4000"
